# 🎬 API Key 管理功能演示

## 📸 界面预览

### 1. 主界面 - API Key管理入口
```
┌─────────────────────────────────────────────────────────────┐
│  CogniGuide                                    [🔑] [📊]    │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  [开始新话题]                                               │
│                                                              │
│  ┌────────────────────────────────────────────────────┐    │
│  │ 想学点什么？                                        │    │
│  │                                                     │    │
│  │ [输入你的问题...]                    [语音] [发送] │    │
│  └────────────────────────────────────────────────────┘    │
│                                                              │
└─────────────────────────────────────────────────────────────┘

┌──────────────┐  ┌──────────────────────────────────────┐
│ 历史对话      │  │ 学习仪表板                [🔑][📊][↶][↷][🌙] │
│              │  ├──────────────────────────────────────┤
│ [新对话]     │  │ 知识图谱                              │
│              │  │ [思维导图可视化]                      │
│ 对话1        │  │                                      │
│ 对话2        │  │ 学习笔记                              │
│ ...          │  │ • 相对论包含狭义和广义相对论          │
│              │  │                                      │
│              │  ├──────────────────────────────────────┤
│              │  │ 学习统计                              │
│ [API Key 管理]│  │ • 总学习时间: 2小时30分钟            │
└──────────────┘  └──────────────────────────────────────┘
```

**注意右上角的🔑图标和侧边栏底部的"API Key 管理"按钮**

---

### 2. API Key管理器界面
```
┌──────────────────────────────────────────────────────────┐
│  API Key 管理                                    [×]      │
│  管理您的 AI 模型 API Keys。您可以随时编辑、查看或删除。  │
├──────────────────────────────────────────────────────────┤
│                                                           │
│  ┌── Google Gemini ──────────────────────────────────┐  │
│  │ 用于 Gemini 2.0 Flash / 2.5 Flash / 1.5 Pro 等模型  │  │
│  │                                                     │  │
│  │  [编辑]  [删除]                                     │  │
│  │                                                     │  │
│  │  ┌─────────────────────────────────────────────┐   │  │
│  │  │ sk-••••••••••••••1234                    [👁️] │   │  │
│  │  └─────────────────────────────────────────────┘   │  │
│  └─────────────────────────────────────────────────────┘  │
│                                                           │
│  ┌── DeepSeek ────────────────────────────────────────┐  │
│  │ 用于 DeepSeek V3.2 / V3.2Think 等模型                │  │
│  │                                                     │  │
│  │  [编辑]  [删除]                                     │  │
│  │                                                     │  │
│  │  ┌─────────────────────────────────────────────┐   │  │
│  │  │ sk-••••••••••••••5678                    [👁️] │   │  │
│  │  └─────────────────────────────────────────────┘   │  │
│  └─────────────────────────────────────────────────────┘  │
│                                                           │
│  ┌── 智谱 GLM ─────────────────────────────────────────┐  │
│  │ 用于 GLM-4.7 Flash / Plus / Air / Bolt 等模型         │  │
│  │                                                     │  │
│  │  [编辑]  [删除]                                     │  │
│  │                                                     │  │
│  │  ┌─────────────────────────────────────────────┐   │  │
│  │  │ 未设置                                        │   │  │
│  │  └─────────────────────────────────────────────┘   │  │
│  └─────────────────────────────────────────────────────┘  │
│                                                           │
│  ┌── 如何获取 API Keys？ ────────────────────────────┐  │
│  │ • Gemini: https://aistudio.google.com/app/apikey  │  │
│  │ • DeepSeek: https://platform.deepseek.com/        │  │
│  │ • GLM: https://open.bigmodel.cn/                  │  │
│  └─────────────────────────────────────────────────────┘  │
│                                                           │
│  ┌──────────────────────────────────────────────────┐  │
│  │            [清除所有 API Keys]                    │  │
│  └──────────────────────────────────────────────────┘  │
│                                                           │
│                                    ┌──────────────────┐  │
│                                    │      完成        │  │
│                                    └──────────────────┘  │
└──────────────────────────────────────────────────────────┘
```

---

### 3. 编辑模式
```
┌── Google Gemini ─────────────────────────────────────┐
│ 用于 Gemini 2.0 Flash / 2.5 Flash / 1.5 Pro 等模型      │
│                                                        │
│  [保存]  [取消]                                        │
│                                                        │
│  ┌────────────────────────────────────────────┐       │
│  │ sk-abc123def456...                        │ [保存]│
│  └────────────────────────────────────────────┘       │
│  输入 Gemini API Key                                  │
│                                                        │
│  提示: 按 Enter 保存，ESC 取消                         │
└────────────────────────────────────────────────────────┘
```

---

### 4. 删除确认对话框
```
┌── Google Gemini ─────────────────────────────────────┐
│ 用于 Gemini 2.0 Flash / 2.5 Flash / 1.5 Pro 等模型      │
│                                                        │
│  ⚠️  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  ⚠️   │
│                                                        │
│  确定要删除 Gemini API Key 吗？                        │
│                                                        │
│  ┌──────────────┐  ┌──────────────┐                 │
│  │  确认删除     │  │    取消       │                 │
│  └──────────────┘  └──────────────┘                 │
└────────────────────────────────────────────────────────┘
```

---

### 5. 快速输入提示条
```
┌──────────────────────────────────────────────────────────┐
│ ⚠️ 使用 Gemini 需配置 API Key                             │
│                                                          │
│ [快速输入 API Key___________________] [管理]            │
└──────────────────────────────────────────────────────────┘
```

---

## 🎯 操作流程演示

### 场景1: 首次设置API Key
1. 用户选择Gemini模型但未设置API Key
2. 页面顶部显示黄色提示条
3. 用户有两个选择：
   - **快速输入**: 在提示条中直接输入，按Enter保存
   - **完整管理**: 点击"管理"按钮打开管理器

### 场景2: 更换失效的API Key
1. 用户点击右上角🔑图标
2. 在管理器中找到对应的API Key
3. 点击"编辑"按钮
4. 修改API Key
5. 点击"保存"或按Enter键
6. ✅ 新Key立即生效

### 场景3: 删除不需要的API Key
1. 用户打开API Key管理器
2. 点击要删除的Key旁边的"删除"按钮
3. 显示确认对话框
4. 点击"确认删除"
5. ✅ Key被删除，恢复到"未设置"状态

### 场景4: 查看当前设置的Keys
1. 用户打开API Key管理器
2. 所有已设置的Keys以脱敏形式显示：`sk-•••••••••••1234`
3. 用户可以点击眼睛图标查看完整Key
4. 再次点击眼睛图标隐藏完整Key

---

## 🎨 UI设计原则

### 1. 层次清晰
- 三个AI提供商独立管理
- 每个提供商有明确的描述
- 操作按钮直观易懂

### 2. 安全性
- 默认脱敏显示
- 删除操作需要确认
- 清除所有需要特别确认

### 3. 便捷性
- 三种访问方式
- 快捷键支持
- 实时保存

### 4. 用户友好
- 提供帮助信息
- 操作反馈及时
- 错误提示清晰

---

## 🔧 技术细节

### 组件结构
```
APIKeyManager (主组件)
├── Header (标题和关闭按钮)
├── Content (主内容区)
│   ├── KeySection (Gemini)
│   ├── KeySection (DeepSeek)
│   ├── KeySection (GLM)
│   └── HelpSection (帮助信息)
└── Footer (完成按钮)
```

### 状态管理
```typescript
interface KeyInfo {
  key: string;          // 实际Key
  isVisible: boolean;   // 是否显示明文
  isEditing: boolean;   // 是否在编辑
  editValue: string;    // 编辑中的值
}

// 每个AI提供商独立管理
const [geminiInfo, setGeminiInfo] = useState<KeyInfo>({...});
const [deepSeekInfo, setDeepSeekInfo] = useState<KeyInfo>({...});
const [glmInfo, setGLMInfo] = useState<KeyInfo>({...});
```

### 数据流
```
用户操作 → 组件状态更新 → 回调函数 → App.tsx → LocalStorage
                                                    ↓
                                            刷新页面保持
```

---

## 📊 测试覆盖

### 单元测试
- [x] 组件渲染
- [x] 状态管理
- [x] 用户交互
- [x] 边界情况

### 集成测试
- [x] 与App.tsx集成
- [x] 与HistorySidebar集成
- [x] LocalStorage读写
- [x] API调用

### E2E测试
- [ ] 完整用户流程（手动测试）
- [ ] 跨浏览器兼容性
- [ ] 移动端适配

---

## 🚀 部署检查清单

- [x] 代码构建无错误
- [x] TypeScript类型检查通过
- [x] 所有功能测试通过
- [x] 文档完整
- [x] 向后兼容
- [ ] 生产环境部署（待用户确认）

---

**修复完成！所有验收标准已通过 ✅**
