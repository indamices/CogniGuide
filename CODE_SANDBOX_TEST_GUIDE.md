# 代码沙盒功能测试指南

## 快速测试步骤

### 1. 启动开发服务器

```bash
cd C:\Users\Administrator\online-game\CogniGuide\CogniGuide
npm run dev
```

### 2. 测试JavaScript执行

在聊天界面输入：
```
给我一个JavaScript排序算法的例子
```

AI回复后，代码块会显示"▶ 运行"按钮，点击后：
- 查看沙盒是否正确打开
- 编辑器是否加载Monaco
- 点击运行按钮
- 检查控制台输出

### 3. 测试Python执行

输入：
```
用Python写一个斐波那契数列
```

测试：
- Python代码是否正确高亮
- Pyodide是否自动加载
- 执行结果是否正确
- 输出是否显示在控制台

### 4. 测试HTML预览

输入：
```
创建一个渐变色卡片HTML页面
```

测试：
- HTML代码是否正确显示
- "显示预览"按钮是否可用
- 预览iframe是否正确渲染
- 样式是否正确应用

### 5. 测试错误处理

在沙盒中输入错误代码：
```javascript
// 语法错误
const x = ;

// 运行时错误
console.log(undefinedVariable);

// 无限循环（会超时）
while(true) {}
```

测试：
- 错误是否被捕获
- 错误消息是否友好
- 堆栈跟踪是否显示
- 超时保护是否触发

### 6. 测试多语言切换

在沙盒中：
1. 切换不同语言
2. 编辑器语言模式是否正确更新
3. 代码高亮是否正确
4. 运行逻辑是否正确

### 7. 浏览器控制台检查

打开开发者工具（F12），检查：
- 是否有控制台错误
- 网络请求是否正常
- Pyodide加载是否成功
- Monaco Editor加载是否成功

## 测试检查清单

### 基本功能
- [ ] 沙盒模态框正确打开/关闭
- [ ] 代码编辑器正确加载
- [ ] 语法高亮正常工作
- [ ] 运行按钮可点击
- [ ] 控制台显示输出
- [ ] HTML预览正确渲染

### 语言支持
- [ ] JavaScript代码执行
- [ ] TypeScript代码执行
- [ ] Python代码执行
- [ ] HTML预览
- [ ] CSS预览

### 安全性
- [ ] 代码在沙盒中运行
- [ ] 无法访问主页面DOM
- [ ] 无限循环被超时终止
- [ ] 错误被正确捕获

### 用户体验
- [ ] 加载状态显示
- [ ] 错误消息友好
- [ ] 快捷键工作（Ctrl+Enter）
- [ ] 控制台自动滚动
- [ ] 移动端布局正常

### 性能
- [ ] 沙盒打开速度 < 1秒
- [ ] 代码执行响应快
- [ ] Pyodide加载不影响初始性能
- [ ] Monaco Editor按需加载

## 常见问题排查

### 问题1: Monaco Editor不加载

**解决方案:**
```bash
npm install @monaco-editor/react
```

检查网络连接，确保CDN可访问。

### 问题2: Python代码不执行

**解决方案:**
- 检查Pyodide是否加载成功
- 打开浏览器控制台查看错误
- 确认网络可以访问 `https://cdn.jsdelivr.net`

### 问题3: 控制台没有输出

**解决方案:**
- 确保代码中有console.log
- 检查代码是否正确执行
- 查看是否有JavaScript错误

### 问题4: HTML预览不显示

**解决方案:**
- 确保HTML代码完整（包含<!DOCTYPE html>）
- 检查是否有语法错误
- 查看iframe是否正确加载

## 性能基准

### 预期性能指标

| 操作 | 目标时间 | 实际时间 |
|------|----------|----------|
| 打开沙盒 | < 500ms | ⬜ 测量 |
| Monaco加载 | < 1s | ⬜ 测量 |
| JS执行 | < 100ms | ⬜ 测量 |
| Python加载 | < 5s (首次) | ⬜ 测量 |
| Python执行 | < 500ms | ⬜ 测量 |
| HTML预览 | < 100ms | ⬜ 测量 |

### 内存使用

| 组件 | 预期内存 | 实际内存 |
|------|----------|----------|
| Monaco Editor | ~20MB | ⬜ 测量 |
| Pyodide | ~40MB | ⬜ 测量 |
| 沙盒组件 | ~5MB | ⬜ 测量 |

## 浏览器兼容性测试

- [ ] Chrome/Edge (最新版)
- [ ] Firefox (最新版)
- [ ] Safari (最新版)
- [ ] 移动浏览器
  - [ ] iOS Safari
  - [ ] Android Chrome

## 回归测试

确保以下功能不受影响：

- [ ] 聊天功能正常
- [ ] LaTeX渲染正常
- [ ] 代码高亮正常
- [ ] 语音功能正常（如果已实现）
- [ ] 间隔重复系统正常
- [ ] 学习分析正常

## 报告问题

发现问题时，请记录：

1. **问题描述**: 清晰描述问题
2. **复现步骤**: 如何触发问题
3. **预期行为**: 应该发生什么
4. **实际行为**: 实际发生了什么
5. **环境信息**:
   - 浏览器版本
   - 操作系统
   - 控制台错误
   - 截图（如果可能）

## 测试完成确认

- [ ] 所有基本功能测试通过
- [ ] 所有语言支持测试通过
- [ ] 安全性测试通过
- [ ] 性能测试达标
- [ ] 浏览器兼容性测试通过
- [ ] 回归测试通过
- [ ] 文档完整

**测试人员签名**: _______________
**测试日期**: _______________
**测试结果**: ✅ 通过 / ⚠️ 有问题 / ❌ 失败
